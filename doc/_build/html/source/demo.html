

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Demonstration &mdash; auTomo 0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Credits" href="credits.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> auTomo
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Demonstration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#starting-processing">Starting processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tomosaic-workflow">Tomosaic workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">auTomo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Demonstration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/demo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="demonstration">
<h1>Demonstration<a class="headerlink" href="#demonstration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="starting-processing">
<h2>Starting processing<a class="headerlink" href="#starting-processing" title="Permalink to this headline">¶</a></h2>
<p>In the directory containing all collected HDF5 data files, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">automo_process_dir</span>
</pre></div>
</div>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--ini_file</span></code> and <code class="docutils literal notranslate"><span class="pre">--params_file</span></code> flags to specify the location and filenames of the configuration
and parameter files. Otherwise, Automo will use the files in the <code class="docutils literal notranslate"><span class="pre">macros</span></code> folder of its source directory. After moving
each file to the proper folder, Automo does the following:</p>
<ul class="simple">
<li><p>If the file is of type <code class="docutils literal notranslate"><span class="pre">tomo_180</span></code> or <code class="docutils literal notranslate"><span class="pre">tomo_360</span></code>, Automo runs operation scripts according to the sequence and parameters specified in the <code class="docutils literal notranslate"><span class="pre">ini</span></code> and <code class="docutils literal notranslate"><span class="pre">csv</span></code> files. After the operations finish, a bash script with executed commands will be created in the folder.</p></li>
<li><p>If the file is of type <code class="docutils literal notranslate"><span class="pre">tomosaic</span></code>, Automo will not execute the commands, but will create a bash scripts of commands for the user to execute manually in bash.</p></li>
</ul>
<p>If the directory has already been organized either by hand or by the beamline control software, the <code class="docutils literal notranslate"><span class="pre">automo_process_dir</span></code>
can be skipped, and you may want to just generate the bash commands used to run processing operations. For this, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">automo_create_commands</span> <span class="o">--</span><span class="nb">type</span> <span class="o">&lt;</span><span class="n">tomo_180</span><span class="p">,</span> <span class="n">tomo_360</span><span class="p">,</span> <span class="ow">or</span> <span class="n">tomosaic</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This tells Automo to generate a bash script file at the current folder, with the operations and parameters provided
in the specified (or default) configuration file and parameter file.</p>
</div>
<div class="section" id="tomosaic-workflow">
<h2>Tomosaic workflow<a class="headerlink" href="#tomosaic-workflow" title="Permalink to this headline">¶</a></h2>
<p>This section talks about the workflow of Tomosaic-type data processing using Automo. Tomosaic allows mosaic
tomography reconstruction to be performed either after merging all HDF5 files into a single file with stiching
and blending in both x- and y-direction (whole-block mode, WBM), or directly by stitching sinograms in the x-direction
(single-slice mode, SSM). While image blending and sub-pixel shifting is currently only supported in WBM, SSM
provides a light-weight reconstruction option which demands less memory and hard drive space. The major workflow
is summarized in Fig. 2 of the <a class="reference external" href="http://journals.iucr.org/s/issues/2018/05/00/il5010/il5010.pdf">Tomosaic paper</a>.</p>
<a class="reference internal image-reference" href="../_images/tomosaic_workflow.png"><img alt="Tomosaic workflow" src="../_images/tomosaic_workflow.png" style="width: 600px;" /></a>
<p>The general procedure of Tomosaic processing using Automo is described below. Again, you can utilize <code class="docutils literal notranslate"><span class="pre">automo_create_commands</span></code>
to generate the bash commands with a series of operations.</p>
<ol class="arabic">
<li><p>In the folder containing the data files of all scanned tiles, run <code class="docutils literal notranslate"><span class="pre">automo_tomosaic_creates_meta</span></code> with position
offset in x and y specified using the <code class="docutils literal notranslate"><span class="pre">--x_shift</span></code> and <code class="docutils literal notranslate"><span class="pre">--y_shift</span></code> flags. This creates a file called
<code class="docutils literal notranslate"><span class="pre">mosaic_meta.py</span></code> in the current directory.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">automo_tomosaic_reorg</span> <span class="pre">--ds</span> <span class="pre">1</span></code>. This creates a folder called <code class="docutils literal notranslate"><span class="pre">data_raw_1x</span></code> and moves all HDF5 files in it.
If you want downsampled copies of the data files, modify the <cite>–ds</cite> flag, with different downsampling levels
separated by commas (<code class="docutils literal notranslate"><span class="pre">,</span></code>). For example, <code class="docutils literal notranslate"><span class="pre">--ds</span> <span class="pre">1,2,4</span></code>. Files downsampled for 2 times will be saved in folder
<code class="docutils literal notranslate"><span class="pre">data_raw_2x</span></code>, and same pattern for the rest.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">automo_tomosaic_preview</span> <span class="pre">--frame</span> <span class="pre">0</span> <span class="pre">--pano</span> <span class="pre">auto</span></code> to create separate projections and flat fields at 0 degree,
as well as stitched panoramas at 0 and 180 degrees.</p></li>
<li><p>(Optional) Run <code class="docutils literal notranslate"><span class="pre">automo_tomosaic_register</span></code> to realign the tiles. This creates a file called <code class="docutils literal notranslate"><span class="pre">shifts.txt</span></code> with
each line of it following the format of</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tile_index_y</span> <span class="n">tile_index_x</span> <span class="n">y_shift_to_right_tile</span> <span class="n">x_shift_to_right_tile</span> <span class="n">y_shift_to_bottom_tile</span> <span class="n">x_shift_to_bottom_tile</span>
</pre></div>
</div>
<p>If this step is skipped (and thus <code class="docutils literal notranslate"><span class="pre">shifts.txt</span></code> doesn’t exist), Automo will use the shift values provided in the
<code class="docutils literal notranslate"><span class="pre">mosaic_meta.py</span></code> for subsequent procesures.</p>
</li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">automo_tomosaic_center</span> <span class="pre">--center_st</span> <span class="pre">auto</span> <span class="pre">--center_end</span> <span class="pre">auto</span> <span class="pre">--row_st</span> <span class="pre">0</span> <span class="pre">--row_end</span> <span class="pre">auto</span> <span class="pre">--mode</span> <span class="pre">discrete</span></code>. Automo
try to find the rotation centers for specified rows of tiles. If <code class="docutils literal notranslate"><span class="pre">--center_st</span></code> or <code class="docutils literal notranslate"><span class="pre">--center_end</span></code> is set to <code class="docutils literal notranslate"><span class="pre">auto</span></code>,
Automo will guess the range for center search using phase correlation. If <code class="docutils literal notranslate"><span class="pre">--method</span></code> is set to <code class="docutils literal notranslate"><span class="pre">pc</span></code>, then the
phase correlation results will be final. Otherwise, the range for center searching using <code class="docutils literal notranslate"><span class="pre">manual</span></code>, <code class="docutils literal notranslate"><span class="pre">entropy</span></code>,
or <code class="docutils literal notranslate"><span class="pre">vo</span></code> will be set to be +/-5 of the phase correlation guess. For <code class="docutils literal notranslate"><span class="pre">manual</span></code> and <code class="docutils literal notranslate"><span class="pre">entropy</span></code>, trial reconstructions
will be saved as <code class="docutils literal notranslate"><span class="pre">center/&lt;row_number&gt;/&lt;center_value&gt;.tiff</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">--method</span></code> is anything other than <code class="docutils literal notranslate"><span class="pre">manual</span></code>, or if phase correlation is used to provide the initial guess, then
Automo will create a file named <code class="docutils literal notranslate"><span class="pre">center_pos.txt</span></code> at the current directory, with each line indicating the row number
and the center position at that row. Otherwise, you need to manually create this file in order to the reconstruction
script to read.</p>
<p>Since setting <code class="docutils literal notranslate"><span class="pre">--method</span></code> to <code class="docutils literal notranslate"><span class="pre">manual</span></code> or <code class="docutils literal notranslate"><span class="pre">entropy</span></code> lets Aumoto create reconstructions, it is also a way to generate
reconstruction previews.</p>
</li>
<li><p>(Only needed for WBM) Run <code class="docutils literal notranslate"><span class="pre">automo_tomosaic_merge</span></code> to fuse the HDF5 files into a single one. The default name and location
of the created file is <code class="docutils literal notranslate"><span class="pre">fulldata_flatcorr_1x/fulldata_flatcorr_1x.h5</span></code>.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">automo_tomosaic_recon</span></code> for final reconstruction. Make sure the <code class="docutils literal notranslate"><span class="pre">--mode</span></code> flag is set correctly: use <code class="docutils literal notranslate"><span class="pre">merged</span></code>
for WBM, and <code class="docutils literal notranslate"><span class="pre">discrete</span></code> for SSM. SSM is recommended if there is only one row of tiles.</p></li>
</ol>
<p>By using <code class="docutils literal notranslate"><span class="pre">automo_create_commands</span> <span class="pre">--type</span> <span class="pre">tomosaic</span></code>, a bash script following the above procedureS (assuming WBM)
can be generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">automo_tomosaic_create_meta</span> <span class="o">--</span><span class="n">x_shift</span> <span class="mi">1000</span> <span class="o">--</span><span class="n">y_shift</span> <span class="mi">1000</span>
<span class="n">automo_tomosaic_reorg</span> <span class="o">--</span><span class="n">ds</span> <span class="mi">1</span>
<span class="n">automo_tomosaic_preview</span> <span class="o">--</span><span class="n">frame</span> <span class="mi">0</span> <span class="o">--</span><span class="n">pano</span> <span class="n">auto</span>
<span class="n">automo_tomosaic_register</span>
<span class="n">automo_tomosaic_center</span> <span class="o">--</span><span class="n">center_st</span> <span class="n">auto</span> <span class="o">--</span><span class="n">center_end</span> <span class="n">auto</span> <span class="o">--</span><span class="n">row_st</span> <span class="mi">0</span> <span class="o">--</span><span class="n">row_end</span> <span class="mi">1</span> <span class="o">--</span><span class="n">mode</span> <span class="n">discrete</span> <span class="o">--</span><span class="n">method</span> <span class="n">manual</span>
<span class="n">automo_tomosaic_merge</span>
<span class="n">automo_tomosaic_recon</span> <span class="o">--</span><span class="n">mode</span> <span class="n">merged</span> <span class="o">--</span><span class="n">chunk_size</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Correspondingly, <code class="docutils literal notranslate"><span class="pre">automo.ini</span></code> should contain the following in the <code class="docutils literal notranslate"><span class="pre">robos</span></code> section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tomosaic</span> <span class="o">=</span> <span class="n">automo_tomosaic_create_meta</span><span class="p">,</span> <span class="n">automo_tomosaic_reorg</span><span class="p">,</span> <span class="n">automo_tomosaic_preview</span><span class="p">,</span> <span class="n">automo_tomosaic_register</span><span class="p">,</span> <span class="n">automo_tomosaic_center</span><span class="p">,</span> <span class="n">automo_tomosaic_merge</span><span class="p">,</span> <span class="n">automo_tomosaic_recon</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">automo_params.csv</span></code> should have the following settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">automo_tomosaic_reorg</span><span class="p">;</span> <span class="n">ds</span><span class="p">;</span> <span class="mi">1</span>
<span class="n">automo_tomosaic_create_meta</span><span class="p">;</span> <span class="n">x_shift</span><span class="p">;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">y_shift</span><span class="p">;</span> <span class="mi">1000</span>
<span class="n">automo_tomosaic_preview</span><span class="p">;</span> <span class="n">frame</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pano</span><span class="p">;</span> <span class="n">auto</span>
<span class="n">automo_tomosaic_register</span>
<span class="n">automo_tomosaic_merge</span>
<span class="n">automo_tomosaic_center</span><span class="p">;</span> <span class="n">center_st</span><span class="p">;</span> <span class="n">auto</span><span class="p">;</span> <span class="n">center_end</span><span class="p">;</span> <span class="n">auto</span><span class="p">;</span> <span class="n">row_st</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row_end</span><span class="p">;</span> <span class="mi">1</span><span class="p">;</span> <span class="n">mode</span><span class="p">;</span> <span class="n">discrete</span>
<span class="n">automo_tomosaic_recon</span><span class="p">;</span> <span class="n">mode</span><span class="p">;</span> <span class="n">merged</span><span class="p">;</span> <span class="n">chunk_size</span><span class="p">;</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="credits.html" class="btn btn-neutral float-right" title="Credits" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Argonne National Laboratory

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>