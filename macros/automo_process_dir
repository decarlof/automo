#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
AuTomo example to generage sample previews.
"""

from __future__ import print_function

import argparse
import os
import sys
from os.path import expanduser
import dxchange
import warnings
import numpy as np
from glob import glob
import re, shutil
from tqdm import tqdm
import automo
import automo.util as util
import automo.robo


automo_preview = {'proj_start': 'auto', 'proj_end': 'auto', 'proj_step': 'auto', 'slice_start': 'auto', 'slice_end': 'auto', 'slice_step': 'auto'}

automo_center = {'rot_start': 860, 'rot_end': 1060, 'rot_step': 1, 'slice': 600, 'n_slice': -1, 'medfilt_size': 3,
              'level': 0, 'pad_length': 1000, 'debug': 0}

automo_recon = {'center_folder': 'center', 'sino_start': 0, 'sino_end': 1200, 'sino_step': 1, 'medfilt_size': 1,
              'level': 0, 'pad_length': 1000, 'chunk_size': 50, 'debug': 0}

automo_preview_360 = {'proj_start': 'auto', 'proj_end': 'auto', 'proj_step': 'auto', 'slice_start': 'auto', 'slice_end': 'auto', 'slice_step': 'auto'}

automo_center_360 = {'rot_start': 1400, 'rot_end': 1650, 'rot_step': 1, 'slice_start': 600, 'n_slice': -1,  'medfilt_size': 1,
                  'level': 0}

automo_recon_360 = {'center_folder': 'center', 'sino_start': 0, 'sino_end': 1200, 'sino_step': 1, 'medfilt_size': 1,
                  'level': 0, 'chunk_size': 50, 'pad_length': 1000, 'debug': 0}

automo_tomosaic_preview = {'frame': 0, 'pano': 'auto'}

automo_tomosaic_center = {'center_st': 'auto', 'center_end': 'auto', 'row_st': 0, 'row_end': 1}


automo_tomosaic_recon = {'mode': 'merged', 'chunk_size': 5}

    
def main(arg):

    parser = argparse.ArgumentParser()
    parser.add_argument("--prefix", help="existing recon foldername", default='')
    parser.add_argument("--shift", help="shift between datasets", default='auto')
    parser.add_argument("--new_folder",help="target folder", default='auto')
    args = parser.parse_args()

    automo.robo.process_folder(os.getcwd(),
			       check_usage=False,
                               automo_preview=automo_preview,
                               automo_center=automo_center,
                               automo_recon=automo_recon,
                               automo_preview_360=automo_preview_360,
                               automo_center_360=automo_center_360,
                               automo_recon_360=automo_recon_360,
                               automo_tomosaic_preview=automo_tomosaic_preview,
                               automo_tomosaic_center=automo_tomosaic_center,
                               automo_tomosaic_recon=automo_tomosaic_recon)


if __name__ == "__main__":
    main(sys.argv[1:])